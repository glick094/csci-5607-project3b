<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<meta name="description" content="CSCI 5607 - Computer Graphics 1">
<meta name="author" content=":sectnum">
<title>Project 3B - Ray Tracing 2: Triangles &amp; Recursion</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #F00 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #04D } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #00F; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #800 } /* Name.Constant */
pre.pygments .tok-nd { color: #A2F } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #00F } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #00F; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #A2F; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #BBB } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #00F } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Project 3B - Ray Tracing 2: Triangles &amp; Recursion</h1>
<div class="details">
<span id="author" class="author">Aaron Glick (glick094)</span><br>
<span id="revdate">2025-10-31</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_grading">Grading</a>
<ul class="sectlevel2">
<li><a href="#_requirements">Requirements</a></li>
<li><a href="#_additional_features">Additional Features:</a></li>
<li><a href="#_extra_credit">Extra credit</a></li>
</ul>
</li>
<li><a href="#_writeup">Writeup</a>
<ul class="sectlevel2">
<li><a href="#_viewing_frustum">Viewing Frustum</a>
<ul class="sectlevel3">
<li><a href="#_camera_placement_film_resolution_and_aspect_ratio">Camera placement, film resolution, and aspect ratio</a></li>
</ul>
</li>
<li><a href="#_lighting">Lighting</a>
<ul class="sectlevel3">
<li><a href="#_light_sources">Light sources</a>
<ul class="sectlevel4">
<li><a href="#_ambient_lighting">Ambient Lighting</a></li>
<li><a href="#_point_lights">Point Lights</a></li>
<li><a href="#_directional_lights">Directional Lights</a></li>
<li><a href="#_spot_lights">Spot Lights</a></li>
</ul>
</li>
<li><a href="#_shadows">Shadows</a></li>
<li><a href="#_reflection">Reflection</a></li>
<li><a href="#_refraction">Refraction</a></li>
</ul>
</li>
<li><a href="#_scene">Scene</a>
<ul class="sectlevel3">
<li><a href="#_colors_and_background">Colors and Background</a></li>
<li><a href="#_materials">Materials</a>
<ul class="sectlevel4">
<li><a href="#_phong_lighting_model">Phong lighting model</a></li>
<li><a href="#_diffuse_lighting">Diffuse lighting</a></li>
<li><a href="#_specular_lighting">Specular lighting</a></li>
</ul>
</li>
<li><a href="#_textures">Textures</a></li>
<li><a href="#_geometries">Geometries</a>
<ul class="sectlevel4">
<li><a href="#_spheres">Spheres</a></li>
<li><a href="#_triangles">Triangles</a></li>
<li><a href="#_constructive_solid_geometry">Constructive Solid Geometry</a></li>
<li><a href="#_implicit_surfaces">Implicit Surfaces</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_optimization">Optimization</a>
<ul class="sectlevel3">
<li><a href="#_sampling">Sampling</a></li>
<li><a href="#_recursion">Recursion</a></li>
<li><a href="#_parallelization">Parallelization</a></li>
<li><a href="#_acceleration_with_bounding_volume_hierarchy">Acceleration with Bounding Volume Hierarchy</a></li>
<li><a href="#_acceleration_with_octtrees">Acceleration with OctTrees</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_art_submission">Art Submission</a></li>
<li><a href="#_access_source_code">Access source code</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>CSCI 5607 (Fall 2025)</p>
</div>
<div class="paragraph">
<p>I&#8217;ve tried to set up this document both in terms of simplicity to understand my ray tracer implementation, but also make it easy to grade.
At the top of this document, I&#8217;ve included the checklist of <a href="#requirements">requirements</a>, <a href="#additional-features">features</a>, and <a href="#extra-credit">extra credit</a> I completed for the project. Each has check box showing it is complete, and a link to that section of the report. The body of the document walks through the ray tracer as if I were to explain it to someone, and is prefaced in the <a href="#overview">Overview</a></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_grading">Grading</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_requirements">Requirements</h3>
<div id="requirements" class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; Arbitrary <a href="#camera-pos">camera placement</a>, <a href="#film-resolution">film resolution</a>, and <a href="#camera-fov-ha">aspect ratio</a></p>
</li>
<li>
<p>&#10003; Arbitrary scenes with <a href="#spheres">spheres</a>, <a href="#triangles">triangles-no-normals</a> (both without and <a href="#triangles-with-normals">with vertex normals</a>), and arbitrary <a href="#background-colors">background colors</a></p>
</li>
<li>
<p>&#10003; Arbitrary <a href="#materials">materials</a>, including <a href="#diffuse-lighting">diffuse</a> and <a href="#specular-lighting">specular</a> shading, <a href="#reflections">reflections</a>, and <a href="#refractions">refractions</a></p>
</li>
<li>
<p>&#10003; <a href="#point-lights">Point</a> and <a href="#directional-lights">directional lights</a></p>
</li>
<li>
<p>&#10003; <a href="#ambient-light">Ambient lighting</a></p>
</li>
<li>
<p>&#10003; <a href="#shadows">Shadows</a></p>
</li>
<li>
<p>&#10003; Recursion to a <a href="#max-depth">bounded depth</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_additional_features">Additional Features:</h3>
<div id="additional-features" class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; (5) <a href="#procedural-texturing">Procedural texturing</a> or normal mapping (checkerboard, wood, marble, mandelbrot set, etc..)</p>
</li>
<li>
<p>&#10003; (5) <a href="#spot-lights">Spot lights</a></p>
</li>
<li>
<p>&#10003; (5) <a href="#textures">Texture mapping</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_extra_credit">Extra credit</h3>
<div id="extra-credit" class="ulist checklist">
<ul class="checklist">
<li>
<p>&#10003; (5) <a href="#csg">Constructive Solid Geometry</a> (<a href="#csg-union">union</a>, <a href="#csg-diff">difference</a>, and <a href="#csg-intersect">intersection</a> of primitives)</p>
</li>
<li>
<p>&#10003; (10) An acceleration structure: <a href="#bvh">BVH</a>, BSP, OctTree, etc. (measure the performance impact on different scenes!)</p>
</li>
<li>
<p>&#10003; (25) Ray trace (transformed) <a href="#implicit-surfaces">implicit surfaces</a> with <a href="#ray-marching">ray-marching</a> (<a href="https://rb.gy/o0sefm" class="bare">https://rb.gy/o0sefm</a>)</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writeup">Writeup</h2>
<div class="sectionbody">
<div id="overview" class="paragraph">
<p>Overall, I found lots of useful resources online, but in particular I heavily relied on <a href="https://gabrielgambetta.com/computer-graphics-from-scratch">Computer Graphics from Scratch</a> by Gabriel Gambetta, the <a href="https://iquilezles.org/articles/">articles</a> from Inigo Quilez, and <a href="https://raytracing.github.io/books/RayTracingInOneWeekend.html">Ray tracing in one weekend</a>. I was influenced by <a href="https://github.com/ssloy/tinyraytracer/tree/master">tinyraytracer</a> and <a href="https://github.com/tcbrindle/raytracer.hpp/tree/master">compile-time ray tracer</a> to help optimize my code and consider different perspectives.</p>
</div>
<div class="paragraph">
<p>I am going to walk through talking about the ray tracer from the building blocks that allow us to make a complete ray tracer. I first start with the frustum, or the orientation of the camera and the viewport into the screen.</p>
</div>
<div class="paragraph">
<p>Then I describe our lighting, since you can&#8217;t have ray tracing without light! So we&#8217;ll go through ambient lighting, adding point, directional, and spot lights, how these lights can create shadows, and finally how light may interact with an object via reflection and refraction.</p>
</div>
<div class="paragraph">
<p>This sets the stage for talking about my approach to color and materials. I use the phong model to incorporate our components of light for ambient, diffuse, specular, and transmissive components of our materials, to compute the color of light seen by our camera. Then I talk about other ways of making interesting materials, by adding texture to shapes, both from an image (interpolated onto the shape) and using procedural texturing (function based texturing).</p>
</div>
<div class="paragraph">
<p>Once we have the basis for our viewport, our lighting, and our colors and materials, we are finally ready to look at something! I describe our different geometries. We built first from spheres and triangles. Using these primitives, we can then build more complex shapes by combining those primitives to make constructive solid geometries, using unions, difference, and intersection operators. Furthermore, instead of being limited to defining vertices and normals (for more complex lighting) for every point and shape, we can instead provide an analytic equation that defines a surface, and create implicit shapes. This opens the door to all sorts of geometries, from tori, cylinders, and even fractal geometries. We do this by creating a signed distance function, which simply returns positive values for points inside and negative values for points outside a geometric boundary.</p>
</div>
<div class="paragraph">
<p>Finally, I walthrough</p>
</div>
<div class="sect2">
<h3 id="_viewing_frustum">Viewing Frustum</h3>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="https://gabrielgambetta.com/computer-graphics-from-scratch/images/03-camera-orientation.png" alt="orientation of camera" width="300"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="https://gabrielgambetta.com/computer-graphics-from-scratch/images/03-basic-raytracer.png" alt="basics of ray tracing" width="300"></span></p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_camera_placement_film_resolution_and_aspect_ratio">Camera placement, film resolution, and aspect ratio</h4>
<div id="camera-pos" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Camera Position"><span></span>camera_pos: x y z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The camera position is set by parsing the <code>camera_pos</code> field from the scene file and storing it in the eye variable (from <code>parse_pga.h</code>),which serves as the origin point for all primary rays cast into the scene. The camera system uses three bases to define the frustrum: the eye point, a forward direction vector, and an up vector; the camera&#8217;s right vector is computed via cross product and normalized to ensure orthonormality.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Varying <code>camera_pos</code> with (x, y, z) positions listed</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x0_y0_zn1.png" alt="cameraPosNegZ"></span><br>
<code>(0,0,-1)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x0_y1_z0.png" alt="cameraPosNegY"></span><br>
<code>(0,-1,0)</code></p></td>
<td class="tableblock halign-center valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_xn1_y0_z0.png" alt="cameraPosNegX"></span><br>
<code>(-1,0,0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x0_y0_z0.png" alt="cameraPos0"></span><br>
<code>(0,0,0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x1_y0_z0.png" alt="cameraPosX"></span><br>
<code>(1,0,0)</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x0_yn1_z0.png" alt="cameraPosPosY"></span><br>
<code>(0,1,0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/camera_pos/camera_pos_x0_y0_z1.png" alt="cameraPosPosZ"></span><br>
<code>(0,0,1)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Clearly, our camera position is working properly. The above were all created with the following camera settings, replacing the specified <code>camera_pos</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>camera_pos: 0 0 0
camera_fwd: 0 0 -1
camera_up: 0 1 0
camera_fov_ha: 45</pre>
</div>
</div>
<div id="film-resolution" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="film resolution"><span></span>film_resolution: width height</code></pre>
</div>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="https://gabrielgambetta.com/computer-graphics-from-scratch/images/03-viewport.png" alt="viewport"></span></p>
</div>
<div class="paragraph">
<p>Film resolution is specified directly in pixels via the <code>film_resolution: width height</code> command, and the aspect ratio is automatically computed from these dimensions.
This directly deterimines the overall number rays (up to some repeated sample factor) that we need to shoot, since we need to shoot rays for each pixel on our image plane.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Varying <code>film_resolution</code> with (width, height) positions listed</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/film_resolution/film_resolution_small.png" alt="filmResolutionSmall" width="200" height="150"></span><br>
<code>(400,300)</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/film_resolution/film_resolution_large.png" alt="filmResolutionLarge" width="800" height="600"></span><br>
<code>(1200,900)</code></p></td>
</tr>
</tbody>
</table>
<div id="camera-fov-ha" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Camera FOV (HA) aspect ratio"><span></span>camera_fov_ha: ha</code></pre>
</div>
</div>
<div class="paragraph">
<p>The half-angle vertical FOV (<code>camera_fov_ha</code>) is used to compute the distance <code>d</code> from the eye to the image plane using \(d = \angle_\text{HFOV half} / \tan(2 \angle_\text{VFOV half})\), which determines how wide or narrow the viewing frustum appears.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Varying <code>camera_fov_ha</code> with (ha) listed</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/aspect_ratio_fov/camera_fov_ha10.png" alt="fov10"></span><br>
<code>(10)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/aspect_ratio_fov/camera_fov_ha30.png" alt="fov30"></span><br>
<code>(30)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/aspect_ratio_fov/camera_fov_ha60.png" alt="fov60"></span><br>
<code>(60)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/camera_res_aspectRatio/aspect_ratio_fov/camera_fov_ha80.png" alt="fov80"></span><br>
<code>(80)</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_lighting">Lighting</h3>
<div class="sect3">
<h4 id="_light_sources">Light sources</h4>
<div class="paragraph">
<p>We have a few different types of lights. We have ambient light which is the uniform non-directional "world" light, point lights which emit light in all directions radially (and falls off with the inverse-square law), directional lights off at infinity such that emitted light is always parallel, and spot lights which emit light radially within a cone shape. In <a href="#typesoflights">Types of lights</a> we can see a simple example of each of these light sources and how they are additive in a overall rendering.</p>
</div>
<table id="typesoflights" class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Types of lights</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/ambient_light/ambient_light_sphere.png" alt="ambientHigh"></span><br>
<code>ambient_light:  0 .5 0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/point_lights/point_light_sphere.png" alt="pointSphere"></span><br>
<code>point_light: 0 .5 0 1 0 1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/directional_lights/directional_light_sphere.png" alt="directionalSphere"></span><br>
<code>directional_light: 0 .5 0 1 0 1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spot_lights/spot_light_sphere.png" alt="spotSphere"></span><br>
<code>spot_light: 0 .5 0 1 0 1 0 1 2 45 90</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spot_lights/all_lights_sphere.png" alt="allLightsSphere"></span><br>
<code>ambient_light + point_light + directional_light + spot_light</code></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_ambient_lighting">Ambient Lighting</h5>
<div id="ambient-light" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Ambient Light"><span></span>ambient_light: r g b</code></pre>
</div>
</div>
<div class="paragraph">
<p>The ambient light color (specified by <code>ambient_light</code> in the scene file) is multiplied component-wise with each <code>(ar, ag, ab)</code> coefficients (material&#8217;s ambient components, see the <a href="#materials">Materials section</a> for more) to initialize the base illumination for every surface point, providing constant lighting independent of geometry or light positions.
spot light with inner and outer angle</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Varying <code>ambient_light</code> with (r, g, b) listed</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/ambient_light/ambient_sphere.png" alt="ambientSphere"></span><br>
<code>ambient_sphere.txt</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/ambient_light/ambient_light_low.png" alt="ambientLow"></span><br>
<code>(0.2,0.2,0.2)</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/ambient_light/ambient_light_mid.png" alt="ambientMid"></span><br>
<code>(0.5,0.5,0.5)</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/ambient_light/ambient_light_high.png" alt="ambientHigh"></span><br>
<code>(0.8,0.8,0.8)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Ambient lighting provides a simple approximation of global illumination by applying a uniform light contribution to all surfaces in the scene. The ambient contribution is computed by multiplying the global ambient light color by each surface&#8217;s material ambient color, ensuring that shadowed areas are never completely black and providing realistic fill light throughout the scene. This technique is computationally efficient and effective for simulating light that has scattered multiple times throughout the environment, preventing harsh contrast between lit and shadowed regions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_point_lights">Point Lights</h5>
<div id="point-lights" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Point Lights"><span></span>point_light: r g b  x y z</code></pre>
</div>
</div>
<div class="paragraph">
<p>The raytracer implements both point lights and directional lights with physically accurate lighting models. Point lights are positioned at specific 3D locations and use inverse-square falloff \((\frac{1}{d^2})\) to simulate realistic light attenuation, making them ideal for localized light sources like lamps or torches. See <a href="#typesoflights">Types of lights</a> for examples. Below the left diagram from Gambetta, showing two point lights a different positions will have different incident \(\vec{l}\) at point \(Q\). The right diagram shows a point light will have different incident vectors when hitting a flat object.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="https://gabrielgambetta.com/computer-graphics-from-scratch/images/05-point-light.png" alt="point-light-diagram"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="http://i.imgur.com/LUNLBhQ.png" alt="LUNLBhQ"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>And here&#8217;s some examples with different point lights</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. Varying <code>point_light</code> with (r, g, b | x, y, z) listed</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/point_lights/point_light_single.png" alt="pointLightSingle"></span><br>
<code>(5,5,5, -1,1,0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/point_lights/point_light_multiple.png" alt="pointLightMultiple"></span><br>
<code>(5,5,5, -1.0,1.0,0.0)</code><br>
<code>(2,2,2,  2.0,0.5,2.8)</code><br>
<code>(5,5,5,  0.0,3.0,3.0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/point_lights/point_light_colors.png" alt="pointLightColors"></span><br>
<code>(5.0,0.1,0.1, -1.0,1.0,0.0)</code><br>
<code>(0.1,5.0,0.1,  2.0,0.5,2.8)</code><br>
<code>(0.1,0.1,5.0,  0.0,3.0,3.0)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_directional_lights">Directional Lights</h5>
<div id="directional-lights" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Directional Lights"><span></span>directional_light: r g b  x y z</code></pre>
</div>
</div>
<div class="paragraph">
<p>Directional lights, on the other hand, are defined by a direction vector and have no distance-based attenuation, simulating infinitely distant light sources like the sun with parallel light rays. Both light types support full Phong shading with diffuse and specular components (see <a href="#phong-model">[phong-model]</a> for details), and both cast shadows by tracing shadow rays (see <a href="#shadows">Shadows</a> for more) to test for occlusion from other objects in the scene. See <a href="#typesoflights">Types of lights</a> for examples. Below is a diagram from Gambetta, showing two directional lights at different positions (with the same direction, here our <code>x y z</code>), will emit parallel rays, since these are simply a light source at infinity (or in PGA, a light source with a direction).</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="https://gabrielgambetta.com/computer-graphics-from-scratch/images/05-directional-light.png" alt="directional-light-diagram"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Varying <code>directional_light</code> with (r, g, b | x, y, z) listed</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/directional_lights/directional_light_single.png" alt="directionalLightSingle"></span><br>
<code>(5,5,5, -1,1,0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/directional_lights/directional_light_multiple.png" alt="directionalLightMultiple"></span><br>
<code>(5,5,5, -1.0,1.0,0.0)</code><br>
<code>(2,2,2,  2.0,0.5,2.8)</code><br>
<code>(5,5,5,  0.0,3.0,3.0)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/directional_lights/directional_light_colors.png" alt="directionalLightColors"></span><br>
<code>(5.0,0.1,0.1, -1.0,1.0,0.0)</code><br>
<code>(0.1,5.0,0.1,  2.0,0.5,2.8)</code><br>
<code>(0.1,0.1,5.0,  0.0,3.0,3.0)</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_spot_lights">Spot Lights</h5>
<div id="spot-lights" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Spot Lights"><span></span>spot_light: r g b  x y z  dx dy dz  angle1 angle2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spot lights extend the point light model with directional constraints, creating cone-shaped illumination patterns defined by an inner and outer angle. Light intensity smoothly transitions from full brightness within the inner cone to zero at the outer cone boundary using cosine-based falloff. The spot light class is implemented in the <code>Lighting.h</code> header. See <a href="#typesoflights">Types of lights</a> for examples.</p>
</div>
<div class="paragraph">
<p>Below is a diagram of a spot light showing the point and the inner and outer angles on a spot light.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="https://www.povray.org/documentation/images/reference/spotgeom.png" alt="spot-light-diagram"></span></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. Varying <code>spot_light</code> with (r, g, b | x, y, z) listed</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spot_lights/spot_light_single.png" alt="spotLightSingle"></span><br>
<code>1 1 1   0 0.7 0.8   0 -1 -.2   45 60</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spot_lights/spot_light_multiple.png" alt="spotLightMultiple"></span><br>
<code>(1 1 1   -0.6 0.3 0.8   0 -1 -.2   45 60)</code><br>
<code>(1 1 1   0 0.7 0.8   0 -1 -.2   45 60)</code><br>
<code>(1 1 1   0.6 0.3 0.8   0 -1 -.2   45 60)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spot_lights/spot_light_colors.png" alt="spotLightColors"></span><br>
<code>(1 0 0   -0.6 0.3 0.8   0 -1 -.2   45 60)</code><br>
<code>(0 1 0   0 0.7 0.8   0 -1 -.2   45 60)</code><br>
<code>(0 0 1   0.6 0.3 0.8   0 -1 -.2   45 60)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As we can see above, we have a nice 45 degree cone of solid light at the center and the 15 degree halo that drops off with a cosine falloff.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_shadows">Shadows</h4>
<div id="shadows" class="paragraph">
<p>Shadows are computed by casting shadow rays from each surface point toward every light source in the scene before calculating illumination. For point lights, the shadow ray tests for occlusion between the surface and the light position (with distance capped at the light distance), while directional lights use an effectively infinite maximum distance. If any geometry intersects the shadow ray before reaching the light, that light&#8217;s contribution is skipped for that surface point, creating hard shadows with crisp edges.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. Examples showing shadows</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/shadows/ShadowTest.png" alt="shadowTest"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/shadows/shadows.png" alt="shadows"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/shadows/plant.png" alt="plant"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/shadows/pokeball.png" alt="pokeball"></span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_reflection">Reflection</h4>
<div id="reflections" class="paragraph">
<p>Reflections are computed recursively by casting reflected rays from surface intersection points in the mirror direction determined by the surface normal. The reflection direction is calculated using the formula \(\vec{r} = \vec{d} - 2(\vec{d} \cdot \vec{n})\vec{n}\), where \(\vec{d}\) is the incident ray direction and \(\vec{n}\) is the surface normal.</p>
</div>
<div class="paragraph">
<p>I recursively trace this reflected ray with decremented depth to gather the color of what the surface "sees" in the reflection direction, supporting multiple bounces of light through the scene. The resulting reflected color is then blended with the surface&#8217;s local lighting by multiplying each RGB channel by the material&#8217;s specular reflection coefficients <code>(sr, sg, sb)</code>, allowing colored or tinted reflections like metallic surfaces. For pure dielectric materials like glass, I use Schlick&#8217;s approximation of the Fresnel equations to physically blend reflection and refraction based on viewing angle, with grazing angles producing stronger reflections.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. Examples showing reflections</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/mirror_reflection.png" alt="mirror"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/reflection_spheres.png" alt="reflectionSpheres"></span></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/gear.png" alt="gear"></span></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/ambient_cornellbox.png" alt="cornellbox" width="350"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In the middle image we see a highly reflective mirror ball in the center. We are getting a nice reflected image, where all six colored spheres are visible from the warped perspective from reflecting of the mirror sphere. I placed the spheres at different angles to the sides, above, and in front of the mirror ball. You can even see some of the multiple reflections bouncing between spheres of the reflection itself. These, however are limited by our max depth. Furthermore, on the gear we see some interesting reflection with different levels and different normals. And finally, with the cornellbox, we see the reflective glass sphere on the back right of the image, as well as pleasing reflections off the ceiling, walls, and floors.</p>
</div>
</div>
<div class="sect3">
<h4 id="_refraction">Refraction</h4>
<div id="refractions" class="paragraph">
<p>Refraction is implemented using Snell&#8217;s law to compute transmitted ray directions when light passes between materials with different indices of refraction (IOR). The refracted direction is calculated as \(\vec{t} = \eta\vec{d} + (\eta c_1 - c_2)\vec{n}\), where \(\eta = n_1/n_2\) is the ratio of refractive indices, \(c_1 = -\vec{d} \cdot \vec{n}\), and \(c_2 = \sqrt{1 - \eta^2(1-c_1^2)}\). Fresnel equations determine the blend between reflection and refraction contributions based on viewing angle, creating physically accurate glass and transparent materials. When total internal reflection occurs (when \(c_2\) becomes imaginary), only the reflected component is computed.</p>
</div>
<div class="paragraph">
<p>Beer Lambert Law is not currently implemented for absorption within transmissive materials.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. Examples showing refractions</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/refraction_spheres.png" alt="refraction"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/watch_blue_and_gold_cropped.png" alt="watchRefraction"></span></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_scene">Scene</h3>
<div class="sect3">
<h4 id="_colors_and_background">Colors and Background</h4>
<div id="background-colors" class="listingblock">
<div class="content">
<pre>background: r g b</pre>
</div>
</div>
<div class="paragraph">
<p>Colors in the raytracer are represented as floating-point RGB triplets and are clamped to the [0,1] range before being converted to 8-bit values for output. The background color is specified in the scene file using the <code>background</code> command and is returned when a ray fails to intersect any geometry in the scene. Color interpolation is performed linearly during operations like material blending and multi-sample anti-aliasing, ensuring smooth gradients and transitions throughout the rendered image.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. Varying <code>background</code> with (r, g, b) listed</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/background/background_grey.png" alt="backgroundGrey"></span><br>
<code>(0.3,0.3,0.3)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/background/background_red.png" alt="backgroundRed"></span><br>
<code>(0.9,0.3,0.3)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/background/background_green.png" alt="backgroundGreen"></span><br>
<code>(0.3,0.9,0.3)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/background/background_blue.png" alt="backgroundBlue"></span><br>
<code>(0.3,0.3,0.9)</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>We use a similar understanding of color for all the colors that are being rendered on our screen. This applies to lights and material properties. I think that this example, show above in <a href="#spot-lights">Spot Lights</a> nicely shows off the color mixing in our ray tracer. As you can see we get a nice fuschia with mixing red and blue light (mixed with some dark grey from the ground), and then we have this nice gradient from cyan to yellow in the middle, and then on the farthest edge of the reflected shadow we have a nice area of green.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="Images/spot_lights/color_mixing.png" alt="colorMixing"></span></p>
</div>
</div>
<div class="sect3">
<h4 id="_materials">Materials</h4>
<div id="materials" class="listingblock">
<div class="content">
<pre>material: ar ag ab  dr dg db  sr sg sb  ns  tr tg tb  ior</pre>
</div>
</div>
<div class="paragraph">
<p>Materials define how surfaces interact with light through four color components: ambient (ar,ag,ab), diffuse (dr,dg,db), specular (sr,sg,sb), and transmissive (tr,tg,tb), along with a Phong exponent (ns) and index of refraction (ior). The final visible color at each surface point is computed by combining the ambient contribution, diffuse lighting from all visible lights, specular highlights, and optionally reflected/refracted light from recursive ray tracing. Each material component is multiplied with the corresponding light contribution and summed to produce the final pixel color, which is then clamped and tone-mapped for display.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/phong_lighting.png" alt="phongLighting"></span></p>
</div>
<div class="listingblock">
<div class="content">
<pre># Glass sphere in the center
material: 0.2 0.2 0.2 0.2 0.2 0.2 0.7 0.7 0.7 50 1 1 1 1.3
sphere: 0 0 4 1
# Cyan metallic sphere with high diffuse
material: 0.3 0.3 0.3 0 1 1 0.4 0.4 0.4 80 0 0 0 1
sphere: -0.8 -0.25 3 0.4
# Dark blue sphere diffuse but not transmissive
material: 0.3 0.3 0.6 0.1 0.1 0.6 0 0 0 80 0 0 0 1
sphere: 1.8 -0.25 3 0.4
# Red metallic sphere, low diffuse, small transmissive
material: 0.1 0 0 0.9 0.1 0.1 0.3 0.3 0.3 30 0 0 0 1
sphere: 2 0 7 1.8
# Green sphere behind glass to show refraction
material: 0.0 0.7 0.0 0 1 1 0.4 0.7 0.4 80 0 0 0 1
sphere: 0 0.3 10 0.3
# Yellow mirror sphere, high diffuse and transmissive
material: 0.6 0.6 0 0.6 0.6 0.6 1 1 0.6 100 0 0 0 1 0.9
sphere: -3 2 8 1.5</pre>
</div>
</div>
<div class="paragraph">
<p>We see clear specular reflections on the yellow mirror sphere and the cyan sphere. We see clear diffuse shading on the dark blue sphere. We can see the power attenuation through the transmissive components on the glass sphere and the green sphere behind it. We see the color blending in the yellow mirror sphere with the red sphere reflection.</p>
</div>
<div class="sect4">
<h5 id="_phong_lighting_model">Phong lighting model</h5>
<div class="paragraph">
<p>The Phong lighting model is used to compute local illumination at each surface point by summing ambient, diffuse, and specular components. The diffuse term uses Lambert&#8217;s cosine law \(I_d = k_d(\vec{L} \cdot \vec{N})\) where \(\vec{L}\) is the light direction and \(\vec{N}\) is the surface normal. The specular term uses the Phong reflection model \(I_s = k_s(\vec{R} \cdot \vec{V})^{n_s}\) where \(\vec{R}\) is the reflected light direction, \(\vec{V}\) is the view direction, and \(n_s\) controls highlight sharpness; we compute \(\vec{R}\) by reflecting the light direction around the normal rather than using the half-vector (Blinn-Phong) approximation.</p>
</div>
\begin{equation}
I = I_E + K_A I_A + \sum_{L}(K_D (N \cdot L) + K_S (V \cdot R)^n)S_L I_L + K_R I_R + K_T K_T
\end{equation}
<div class="paragraph">
<p>Where \(N\) is the normal to the surface, \(V\) is the direction of the camera, \(L\) is the direction of the light, and \(R\) is the direction reflection from the surface. The \(I_i\) terms correspond to the emissive \((I_E)\), ambient \((I_A)\), diffuse \((I_D)\), intensity \((I_s)\), reflective radiance \((I_R)\), and refractive radiance \((I_T)\) of the light.
The constant \(K_i\) terms correspond similarly to the ambient response \((K_A)\), diffuse response \((K_D)\), spectral response \((K_S)\), reflective coefficient \((K_R)\), and transparency coeficient \((K_T)\).
To other to terms are the Phong specular exponent \((n)\) and the shadow term \(S_L\), which is a boolean that describes if the ray is blocked by an object or not.</p>
</div>
</div>
<div class="sect4">
<h5 id="_diffuse_lighting">Diffuse lighting</h5>
<div id="diffuse-lighting" class="paragraph">
<p>Diffuse lighting simulates matte surface reflection using Lambertian shading, where surface brightness is proportional to the cosine of the angle between the surface normal and light direction. For each light source, the diffuse contribution is calculated as</p>
</div>
\begin{equation}
I_D = K_D \max(0, (N \cdot L)) S_L I_L
\end{equation}
<div class="paragraph">
<p>where \(I_{L}\) is the light intensity, \(K_D\) is the material diffuse color, \(\vec{N}\) is the surface normal, and \(\vec{L}\) is the light direction. The \(\max()\) function ensures that surfaces facing away from lights receive no diffuse contribution, and distance attenuation is applied for point lights.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/arm-reach.png" alt="armReach" width="300"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/materials_diffuse_specular_reflection_refraction/arm-top-rotated.png" alt="armTop" width="340"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>With the provided scenes with the hands, we see clear diffuse lighting. We see darker portions of the arm that are in shadow. All triangles in this scene have the same material, so the diffuse color is the same for all the triangles. However, we see the nice variation in color due to the normals on those triangles, since the dot product changes the intensity of that overall light.</p>
</div>
</div>
<div class="sect4">
<h5 id="_specular_lighting">Specular lighting</h5>
<div id="specular-lighting" class="paragraph">
<p>Specular lighting creates glossy highlights that vary based on viewing angle, simulating mirror-like reflections from smooth surfaces. The specular component is computed using the Phong model is</p>
</div>
\begin{equation}
I_K = K_S (V \cdot R)^n S_L I_L
\end{equation}
<div class="paragraph">
<p>where \(K_S\) is the material specular color, \(V\) is the view direction, \(R\) is the reflected light direction, and \(n\) is the Phong exponent controlling highlight size, \(S_L\) is the shadow term, and \(I_L\) is the light intensity. Higher exponents create tighter, shinier highlights, while lower values produce broader, more matte reflections. Specular highlights only appear when viewing the surface from angles close to the perfect mirror reflection direction.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="Images/shadows/pokeball.png" alt="pokeball"></span></p>
</div>
<div class="paragraph">
<p>In this scene we get nice spectral lighting from 4 different lights. We can see it in the red portion of the pokeball clearly, and then then there&#8217;s nice spectral highlights on the button of the pokeball. I&#8217;ve made the black center sphere highly diffuse and not spectral, so there&#8217;s very little spectral components off of that part, and only a small contribution from reflections.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_textures">Textures</h4>
<div id="textures" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Texture Mapping"><span></span>diffuse_texture: image filename.png</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can use an image or a texture to map a pattern onto a primitive. For <strong>spheres</strong>, UV coordinates are computed lazily using spherical mapping - the surface normal is converted to spherical coordinates (\(\phi\) = longitude, \(\theta\) = latitude), then normalized to <code>[0,1]</code> range where \(u = \frac{\phi + \pi}{2\pi}\) and \(v = \frac{\theta + \frac{\pi}{2}}{\pi}\). For <strong>triangles</strong>, each vertex stores its own UV coordinates \((u_0, v_0)\), \((u_1, v_1)\), \((u_2, v_2)\), which are interpolated using the barycentric coordinates computed during ray-triangle intersection to determine the UV at the exact hit point. Once UVs are computed, the <code>ImageTexture::sample()</code> method clamps them to [0,1], flips the V coordinate (since images have top-left origin but UV space is bottom-left), converts to pixel coordinates, and returns the RGB color at that pixel. For <strong>implicit surfaces</strong> (further explained <a href="#implicit-surfaces">below</a>), triplanar mapping projects the texture  from three orthogonal axes (XY, XZ, YZ planes) and blends them based on the surface normal&#8217;s dominant direction for seamless results.</p>
</div>
<div class="paragraph center">
<p><span class="image"><img src="Images/textures/art_exhibit.png" alt="art exhibit"></span></p>
</div>
<div class="paragraph">
<p>From the image above, we can see our textures getting applied to our spheres. We have Earth, Mars, Jupiter, and the Moon textures, with some added lighting.</p>
</div>
<div id="procedural-texturing" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Procedural Texturing"><span></span>diffuse_texture: checker    r1 g1 b1  r2 g2 b2  scale
diffuse_texture: checker3d  r1 g1 b1  r2 g2 b2  scale
diffuse_texture: wood       r1 g1 b1  r2 g2 b2  scale turbulence
diffuse_texture: marble     r1 g1 b1  r2 g2 b2  scale</code></pre>
</div>
</div>
<div class="paragraph">
<p>Procedural texturing generates surface colors algorithmically rather than from image data, including 2D checkerboard patterns, 3D volumetric checkers, wood grain using turbulent noise, and marble patterns with Perlin noise. Textures can be applied to diffuse, specular, and normal map channels of materials, with UV coordinates computed from sphere parameterization for spheres and barycentric interpolation for triangles. For SDF objects without natural UV coordinates, triplanar mapping projects the texture from three orthogonal directions and blends based on surface normal, ensuring seamless coverage on arbitrary implicit surfaces without distortion.</p>
</div>
<table id="procedural-texture-examples" class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 57.1428%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/textures/textured_spheres.png" alt="textured spheres"></span></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/textures/textured_cornellbox.png" alt="textured cornellbox"></span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Above, we see some interesting procedural texturing in the spheres. From left to right, we have the cyan and magenta sphere with <code>marble</code>, the red and purple sphere with <code>checker</code>, the <code>image</code> center sphere with water caustics, the cyan and fuschia sphere with <code>checker3d</code>, and the green and magenta sphere with <code>wood</code>. The small blue sphere in front of the mirror ball also has <code>image</code> texturing from a cloud phto.
Above, in the cornell box, we see some interesting patterned texturing on the floor of the cornell box (<code>checker3d</code>), and on the red wall (<code>wood</code>), and on the green wall (<code>marble</code>) alongside patterned ceiling with the <code>image</code> for some water caustics. We get some interesting reflections, and also see that our diffuse texture is not being applied in places where we have shadows. This is a place we could improve our ray tracer, since the texture should really be everywhere on our surface.</p>
</div>
</div>
<div class="sect3">
<h4 id="_geometries">Geometries</h4>
<div class="sect4">
<h5 id="_spheres">Spheres</h5>
<div id="spheres" class="listingblock">
<div class="content">
<pre>sphere: x y z radius</pre>
</div>
</div>
<div class="paragraph">
<p>Spheres are defined by a center point <code>(x,y,z)</code> and <code>radius</code>, with ray intersection computed analytically using the quadratic formula. The ray-sphere intersection finds parameter <code>t</code>, which is the intersection point on the sphere closest to the ray. We get the projection of the sphere&#8217;s center on the ray via \((L \cdot p_S)\) and calculate the distance from the center to the projection (to ensure that the ray actually hit the sphere). Then we get find those intersection points by getting the scaled radius based on the distance from the projection to the center. Finally, at the nearest point, we calculate the normal by \(||p_i - p_S||\).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. Examples with spheres</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/spheres/spheres1.png" alt="spheres1"></span><br>
<code>sphere1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/spheres/spheres2.png" alt="spheres2"></span><br>
<code>sphere2</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_triangles">Triangles</h5>
<div id="triangles" class="listingblock">
<div class="content">
<pre>vertex: x y z
triangle: v0 v1 v2</pre>
</div>
</div>
<div class="paragraph">
<p>Triangles without vertex normals use the Mller-Trumbore intersection algorithm for efficient ray-triangle intersection testing. The algorithm computes barycentric coordinates \((u, v)\) and intersection distance \(t\) directly without explicitly computing the plane equation, using the formula \(\vec{O} + t\vec{D} = (1-u-v)\vec{V}_0 + u\vec{V}_1 + v\vec{V}_2\). The triangle&#8217;s surface normal is computed as \(\vec{N} = (\vec{V}_1 - \vec{V}_0) \times (\vec{V}_2 - \vec{V}_0)\) and remains constant across the entire triangle surface, creating flat shading.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. Examples with triangles</caption>
<colgroup>
<col style="width: 57.1428%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/triangles/dragon.png" alt="dragon"></span><br>
<code>dragon</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/triangles/nordic_star.png" alt="triangles"></span><br>
<code>compass</code></p></td>
</tr>
</tbody>
</table>
<div id="triangles-with-normals" class="listingblock">
<div class="content">
<pre>normal: nx ny nz
normal_triangle: v0 v1 v2  n0 n1 n2</pre>
</div>
</div>
<div class="paragraph">
<p>Triangles with vertex normals extend the basic triangle by interpolating normals across the surface using barycentric coordinates for smooth shading. At the intersection point with barycentric coordinates \((u, v)\), the shading normal is computed as \(\vec{N} = (1-u-v)\vec{N}_0 + u\vec{N}_1 + v\vec{N}_2\) and then normalized. This allows triangle meshes to approximate curved surfaces by smoothly varying the normal across faces, producing much more realistic shading than flat-shaded triangles while maintaining the same geometric representation.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. Examples with triangles</caption>
<colgroup>
<col style="width: 57.1428%;">
<col style="width: 42.8572%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/shadows/plant.png" alt="plant"></span><br>
<code>plant</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/spheres_triangles_backgrounds/triangles/nordic_star_normals.png" alt="trianglesNormals"></span><br>
<code>compass with normals</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_constructive_solid_geometry">Constructive Solid Geometry</h5>
<div class="paragraph">
<p>Constructive Solid Geometry (CSG) allows complex shapes to be built by combining primitive spheres using boolean operations, enabling the creation of sophisticated models like gears, mechanical parts, and architectural elements from simple building blocks. CSG objects are represented by a base sphere and one or more operand spheres, with the operation type (union, difference, or intersection) determining how they combine to form the final shape. The implementation follows an interval-based approach: ray intersection with CSG objects requires finding all entry/exit points (t-values) with component spheres, constructing intervals where the ray is inside each sphere, and then combining these intervals according to the CSG operation to determine the final surface boundaries.</p>
</div>
<div id="csg" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Costructive solid geometry"><span></span>sphere: x y z radius                      # Define component spheres
csg_union: base_idx op1 [op2]...          # Combine with union
csg_difference: base_idx op1 [op2]...     # Subtract
csg_intersection: base_idx op1 [op2]...   # Keep only overlap</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. Boolean operations for CSG</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="https://www.povray.org/documentation/images/reference/unionobj.png" alt="union"></span><br>
union: \(A \cap B\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="https://www.povray.org/documentation/images/reference/diffobj.png" alt="difference"></span><br>
difference: \(A - B\)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="https://www.povray.org/documentation/images/reference/isectobj.png" alt="intersection"></span><br>
intersection: \(A \cup B\)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Our CSG implementation is defined in <code>Geometries.h</code> using the <code>CSGObject</code> class, which stores the operation type, base sphere, and a vector of operand spheres. The scene parser allows users to first define individual spheres using standard <code>sphere:</code> commands, then reference them by index in CSG commands. For example, defining <code>sphere: 0 0 0 1.0</code> followed by <code>sphere: 0.5 0 0 0.6</code> creates two spheres at indices 0 and 1; the command <code>csg_difference: 0 1</code> then creates a CSG object where sphere 1 is carved out of sphere 0, producing a spherical cavity. Note, one limitation of my current implementation is that is only works with spheres. I did not have time to add triangles.</p>
</div>
<div class="paragraph">
<p>The CSG intersection algorithm in <code>RayInteractions.h:intersectCSG()</code> handles each operation type differently.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. Examples of <code>csg_union</code>, <code>csg_difference</code>, <code>csg_intersection</code></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/constructive_solid_geometry/csg_operations_basic.png" alt="csgOperationsBasic"></span><br>
<code>csg_union</code><br>
<code>csg_intersection</code><br>
<code>csg_difference</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/constructive_solid_geometry/csg_operations_multiple_difference.png" alt="csgOperationsMultipleDifference"></span><br>
<code>difference with three spheres</code><br>
<code>(sphere: 0.3 1 4.9 1.0)</code><br>
<code>(sphere: 0.3 1 5.5 1.0)</code><br>
<code>(sphere: 0.3 1 6.1 1.0)</code><br>
<code>(csg_difference: 2 1 3)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/constructive_solid_geometry/csg_operations_multiple_intersection.png" alt="csgOperationsMultipleIntersection"></span><br>
<code>intersection with three spheres</code><br>
<code>(sphere: 0 0 8 2.1)</code><br>
<code>(sphere: 1 0 8 2.1)</code><br>
<code>(sphere: 0.5 1.414 8 2.1)</code><br>
<code>(csg_intersection: 1 2 3)</code></p></td>
</tr>
</tbody>
</table>
<div class="sect5">
<h6 id="_union">Union</h6>
<div id="csg-union" class="paragraph">
<p><strong>Union operations</strong> combine multiple spheres into a single object by taking the closest intersection among all components, effectively creating a merged shape where any point inside at least one component sphere is considered inside the CSG object. Our implementation, the merged shape takes the original material of the first input shape, so <code>base_idx</code>. When a ray intersects a CSG union, the raytracer tests the ray against the base sphere and all operand spheres using standard ray-sphere intersection, collecting all intersection points and selecting the one with the smallest positive <code>t</code> value (closest to the camera), which is depicted below in the diagram by <code>a0</code>. The surface normal at the intersection point is taken from whichever component sphere was actually hit, ensuring proper shading at the boundaries between merged primitives. This is the simplest CSG operation computationally, as it requires only finding the minimum <code>t</code> value among all hits, with no complex interval arithmetic. Union operations are useful for modeling organic forms, collections of objects treated as a single entity, or quick approximations of smooth blending between shapes.</p>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="https://www.fotonixx.com/images/efficient_csg/example_hits.png" alt="200"></span></p>
</div>
</div>
<div class="sect5">
<h6 id="_difference">Difference</h6>
<div id="csg-difference" class="paragraph">
<p><strong>Difference operations</strong> carve away operand spheres from a base sphere, creating hollow or sculpted shapes by subtracting volumes from the base geometry. The ray intersection algorithm computes entry/exit intervals for both the base and all operand spheres, using interval arithmetic to construct the final surface: for each operand sphere, we compute where the ray enters (t_enter) and exits (t_exit) that sphere, then remove these intervals from the base sphere&#8217;s intervals to determine where the ray is inside the base but outside all operands. When a ray enters an operand sphere while inside the base (entering a carved-out cavity), the operand&#8217;s inward-facing surface becomes the new boundary, with its normal flipped to point into the cavity for proper lighting. This creates the distinctive "hollowed out" appearance where you can see inside the removed volume.</p>
</div>
<div class="paragraph">
<p>The algorithm works by first finding the base sphere&#8217;s entry and exit points, then iterating through each operand sphere to find subtractive intervals. If the ray enters an operand while inside the base (t_enter_operand is between t_enter_base and t_exit_base), we create a hit at t_enter_operand with the operand&#8217;s inward normal (flipped). Similarly, if the ray exits an operand while inside the base, the surface continues from that point. This allows complex carved shapes like Swiss cheese, mechanical parts with holes, or architectural elements with doorways and windows. The challenge is handling overlapping operands correctly and ensuring the closest valid surface point is returned.</p>
</div>
</div>
<div class="sect5">
<h6 id="_intersection">Intersection</h6>
<div id="csg-intersect" class="paragraph">
<p><strong>Intersection operations</strong> keep only the region where all component spheres overlap, creating the common volume shared by all primitivesessentially the "AND" operation in boolean logic. The ray intersection finds overlapping t-intervals by computing the maximum entry point (last sphere the ray enters) and minimum exit point (first sphere the ray exits) among all spheres. Only if the maximum entry is less than the minimum exit does a valid intersection exist, indicating the ray passes through a region inside all spheres simultaneously. The surface normal is taken from the sphere providing the maximum entry point (the last sphere the ray enters), as this sphere defines the visible boundary of the intersection volume.</p>
</div>
<div class="paragraph">
<p>Algorithmically, intersection CSG works by finding all t_enter and t_exit values for the base and operand spheres, then computing \(t_{\text{enter,final}} = \max(t_{\text{enter,base}}, t_{\text{enter,op1}}, t_{\text{enter,op2}, ...})\) and \(t_{\text{exit,final}} = \min(t_{\text{exit,base}}, t_{\text{exit,op1}}, t_{\text{exit,op2}, ...})\). If \(t_{\text{enter,final}} &lt; t_{\text{exit,final}}\) and both are positive, the ray intersects the CSG object at \(t_{\text{enter,final}}\). This operation is useful for creating complex shapes by constraining geometry to specific regions, such as a sphere clipped by planes (using sphere-sphere intersection to approximate planes) or creating precise geometric constructions like geodesic domes or molecular models where atoms overlap at specific bonding sites.</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_implicit_surfaces">Implicit Surfaces</h5>
<div id="implicit-surfaces" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Implicit Surfaces"><span></span># Basic SDF primitives
sdf_sphere: x y z radius
sdf_box: x y z half_x half_y half_z
sdf_plane_oriented: vertex_idx normal_idx
sdf_torus: x y z major_radius minor_radius
sdf_cylinder: x y z radius
sdf_capped_cylinder: x y z radius half_height</code></pre>
</div>
</div>
<div class="paragraph">
<p>Implicit surfaces represent one of the most powerful and flexible approaches to geometric modeling in computer graphics, defining shapes mathematically through signed distance functions (SDFs) that return the distance from any point in space to the nearest surface. The "signed" aspect is key: the function returns positive values for points outside the shape, negative values for points inside, and exactly zero on the surface boundary. This mathematical representation enables several key advantages over explicit geometry. SDFs are resolution-independentzooming in arbitrarily close to the surface never reveals polygonal facets or discretization artifacts, so we can get nearly infinite amount of details. In particular, fractals, organic forms, and mathematical surfaces (like Mandelbulb or Mandelbox) can be expressed compactly as formulas rather than massive polygon meshes.</p>
</div>
<div class="paragraph">
<p>In addition, we have SDF-based boolean operations which use smooth minimum/maximum functions to create organic blending between shapes, making more varied combinations and control over the combination, unlike CSG on explicit geometry which has sharp joins.</p>
</div>
<div class="paragraph">
<p>Finally, transformations like translation, rotation, and scaling of SDFs can often be implemented by transforming the query point rather than the entire geometry itself.</p>
</div>
<div class="paragraph">
<p>Our implementation in <code>SDF.h</code> defines an abstract <code>SDF</code> base class with a pure virtual <code>evaluate(Point3D p)</code> method that returns the signed distance at any point. Derived classes implement specific primitives:</p>
</div>
<div class="paragraph">
<p><strong>Basic SDF Primitives:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>SDFSphere</strong>: \(d(\vec{p}) = ||\vec{p} - \vec{c}|| - r\) where \(\vec{c}\) is the center and \(r\) is the radius. This is the simplest SDF, computing Euclidean distance to the sphere center and subtracting the radius.</p>
</li>
<li>
<p><strong>SDFBox</strong>: Uses the formula \(d(\vec{p}) = ||\max(\vec{q}, \vec{0})|| + \min(\max(q_x, q_y, q_z), 0)\) where \(\vec{q} = |\vec{p}| - \vec{h}\) and \(\vec{h}\) is the half-extent vector. This elegantly handles both interior and exterior distances.</p>
</li>
<li>
<p><strong>SDFPlane</strong>: \(d(\vec{p}) = \vec{n} \cdot \vec{p} - d_0\) where \(\vec{n}\) is the unit normal and \(d_0\) is the signed distance from the origin. Infinite planes are trivial in SDF form but complex in explicit geometry.</p>
</li>
<li>
<p><strong>SDFTorus</strong>: Computed as \(d(\vec{p}) = \sqrt{(\sqrt{x^2 + z^2} - R)^2 + y^2} - r\) where \(R\) is the major radius and \(r\) is the minor (tube) radius. The formula works by first projecting to the ring in the XZ plane, then computing distance to the circular cross-section.</p>
</li>
</ul>
</div>
<div class="paragraph text-center">
<p><span class="image"><img src="Images/implicit_surfaces/sdf_primitives.png" alt="sdf primitives"></span></p>
</div>
<div class="paragraph">
<p><strong>Oriented SDF Variants:</strong></p>
</div>
<div class="paragraph">
<p>Many SDF primitives have "oriented" variants that support arbitrary rotations specified through normal vectors from the scene&#8217;s vertex/normal pools. For example, <code>sdf_plane_oriented</code> uses a vertex index to define a point on the plane and a normal index for orientation, computing the distance as \(d = (\vec{p} - \vec{p}_0) \cdot \vec{n}\). These oriented primitives use rotation matrices internally to transform query points into the primitive&#8217;s local coordinate system, evaluate the canonical SDF, and then transform results back to world space.</p>
</div>
<div class="paragraph">
<p>The oriented variants are particularly useful for:
- Creating architectural scenes with walls at arbitrary angles
- Defining complex mechanical parts with specific orientations
- Building procedural scenes where orientation is computed algorithmically
- Ensuring consistency with the vertex/normal pool system used for triangles</p>
</div>
<div id="implicit-surfaces-rotation" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Orientable Implicit Surfaces"><span></span># Oriented SDF primitives (using vertex/normal pools)
sdf_plane_oriented: vertex_idx normal_idx
sdf_quad_oriented: vertex_idx half_width half_height normal_idx
sdf_box_oriented: vertex_idx hx hy hz normal_idx
sdf_torus_oriented: vertex_idx major minor normal_idx
sdf_cylinder_oriented: vertex_idx radius normal_idx
sdf_capped_cylinder_oriented: vertex_idx radius half_height normal_idx</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 18. Examples of oriented SDF primitives</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/tori_illusion.png" alt="toriIllusion"></span><br>
Toruses rotated, inside perspective</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/tori_ring.png" alt="toriRing"></span><br>
Toruses rotation, outside perspective</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/pumpkin.png" alt="pumpkin"></span><br>
A festive pumpkin</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Fractal SDFs:</strong></p>
</div>
<div id="implicit-surfaces-complex" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Fractal Implicit Surfaces"><span></span># Fractal SDFs
sdf_mandelbulb: x y z iterations power
sdf_mandelbox: x y z iterations scale
sdf_menger_sponge: x y z iterations</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fractals represent some of the most visually stunning applications of SDF rendering, creating infinitely detailed structures through iterative point transformations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Mandelbulb</strong>: A 3D generalization of the Mandelbrot set using spherical coordinates. The SDF is computed by iterating \(\vec{z} \leftarrow \vec{z}^n + \vec{c}\) in polar form, tracking both the escape distance and derivative magnitude to compute the distance estimate \(d \approx \frac{1}{2} \log(r) \cdot \frac{r}{dr}\).</p>
</li>
<li>
<p><strong>Mandelbox</strong>: Uses "box folding" and "sphere folding" operations iteratively, creating cube-like structures at multiple scales. The algorithm folds coordinates greater than 1.0, applies spherical inversions for points inside a fixed radius, then scales and translates.</p>
</li>
<li>
<p><strong>Menger Sponge</strong>: A recursive cube-based fractal that subdivides and removes cross-shaped sections at each iteration level, creating a sponge-like structure with fractal dimension  2.727.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. Examples of fractal SDFs</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/mandelbulb.png" alt="mandelbulb"></span><br>
<code>sdf_mandelbulb: 0 0 0 7 6</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/mandelbox.png" alt="mandelbox"></span><br>
<code>sdf_mandelbox: 0 0 0 5 2</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/menger_sponge.png" alt="mengerSponge"></span><br>
<code>sdf_menger_sponge: 0 0 0 4</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>These fractals are expensive to render (requiring 8-20 SDF evaluations per iteration, times multiple marching steps), but produce results impossible to achieve with traditional polygon modeling.</p>
</div>
<div class="paragraph">
<p><strong>SDF Boolean Operations:</strong></p>
</div>
<div class="paragraph">
<p>Boolean operations on SDFs are implemented through simple arithmetic on distance values:</p>
</div>
<div id="implicit-surfaces-combination" class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="Implicit Surface Combination"><span></span># SDF boolean operations
sdf_union: base_idx operand1 operand2...
sdf_intersection: base_idx operand1 operand2...
sdf_difference: base_idx operand1 operand2...

sdf_smooth_union: smoothing_factor base_idx operand1 operand2...
sdf_smooth_intersection: smoothing_factor base_idx operand1 operand2...
sdf_smooth_difference: smoothing_factor base_idx operand1 operand2...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Union</strong>: \(d_{union}(\vec{p}) = \min(d_1(\vec{p}), d_2(\vec{p}))\)  take the minimum distance to either surface</p>
</li>
<li>
<p><strong>Intersection</strong>: \(d_{intersect}(\vec{p}) = \max(d_1(\vec{p}), d_2(\vec{p}))\)  take the maximum distance (both must be satisfied)</p>
</li>
<li>
<p><strong>Difference</strong>: \(d_{diff}(\vec{p}) = \max(d_1(\vec{p}), -d_2(\vec{p}))\)  subtract by negating the second field</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These operations combine instantly at render time (unlike polygon CSG which requires complex mesh operations), and can be enhanced with smooth minimum/maximum functions for organic blending: \(smin(a,b,k) = \min(a,b) - \frac{h^2}{4k}\) where \(h = \max(k - |a-b|, 0)\).</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/sdf_operations.png" alt="sdf operations"></span><br>
<code>sdf_union</code> (gold)<br>
<code>sdf_union</code> (blue)</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><span class="image"><img src="Images/implicit_surfaces/sdf_operations_smooth.png" alt="sdf operations smooth"></span><br>
<code>sdf_smooth_union: 0.25</code> (gold)<br>
<code>sdf_smooth_union: 0.75</code> (blue)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>SDF Transformation Wrapper:</strong></p>
</div>
<div class="paragraph">
<p>The <code>SDFTransform</code> class wraps any SDF primitive with a translation offset, evaluating \(d(\vec{p}) = d_{child}(\vec{p} - \vec{t})\) where \(\vec{t}\) is the translation vector. This allows primitives defined at the origin to be positioned anywhere in the scene without modifying their evaluation functions. More complex transformations (rotation, scale, shear) could be added by transforming the query point through the inverse transformation matrix before evaluation.</p>
</div>
<div id="ray-marching" class="paragraph">
<p><strong>Ray Marching (Sphere Tracing) Algorithm:</strong></p>
</div>
<div class="paragraph">
<p>Ray marching is the rendering technique used to find intersections between rays and implicit surfaces, differing fundamentally from the analytical intersection tests used for spheres and triangles. The algorithm exploits the Lipschitz continuity property of SDFs: the distance returned at any point is guaranteed to be a safe lower bound on how far we can move in any direction without missing the surface.</p>
</div>
<div class="paragraph">
<p>The sphere tracing algorithm in <code>SDF.h:rayMarch()</code> proceeds as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Initialize</strong>: Start at the ray origin plus a small offset (\(t_0\) = 0.01) to avoid self-intersection on secondary rays. The offset prevents numerical issues where a reflected ray immediately re-intersects the surface it originated from.</p>
</li>
<li>
<p><strong>March loop</strong>: For each iteration (maximum 128 steps):</p>
<div class="ulist">
<ul>
<li>
<p>Compute current position: \(\vec{p} = \vec{o} + t \cdot \vec{d}\) where \(\vec{o}\) is ray origin, \(\vec{d}\) is direction, \(t\) is accumulated distance</p>
</li>
<li>
<p>Evaluate SDF: \(dist = sdf.evaluate(\vec{p})\)</p>
</li>
<li>
<p><strong>Hit test</strong>: If \(dist &lt; \epsilon\) (epsilon = 0.003), we&#8217;ve found the surface</p>
</li>
<li>
<p><strong>Distance test</strong>: If \(t &gt; d_{max}\) (max = 100.0), the ray escaped the scene</p>
</li>
<li>
<p><strong>Step forward</strong>: \(t \leftarrow t + \max(dist, \epsilon_{min})\) where \(\epsilon_{min}\) = 0.001 prevents infinite loops in degenerate cases</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Normal computation</strong>: Upon hitting the surface, compute the gradient of the SDF using the tetrahedron technique, which evaluates the SDF at four points arranged in a tetrahedron around the hit point. This requires only 4 SDF evaluations compared to 6 for central differences, using the formula:</p>
<div class="stemblock">
<div class="content">
\[\vec{n} = \text{normalize}\begin{pmatrix}
  sdf(\vec{p} + \vec{k}_1) - sdf(\vec{p} - \vec{k}_1) \\
  sdf(\vec{p} + \vec{k}_2) - sdf(\vec{p} - \vec{k}_2) \\
  sdf(\vec{p} + \vec{k}_3) - sdf(\vec{p} - \vec{k}_3)
\end{pmatrix}\]
</div>
</div>
<div class="paragraph">
<p>where \(\vec{k}_i\) are offset vectors arranged tetrahedrally with magnitude \(\delta\) (0.002).</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Performance Optimizations:</strong></p>
</div>
<div class="paragraph">
<p>Several optimizations make ray marching practical for interactive rendering:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Adaptive epsilon</strong>: The surface threshold epsilon is set relatively large (0.003) compared to geometric precision, trading perfect accuracy for 2-3x fewer steps.</p>
</li>
<li>
<p><strong>Early termination</strong>: Rays that escape beyond 50 units after 10 steps are immediately culled, assuming they&#8217;ll never hit anything.</p>
</li>
<li>
<p><strong>Minimum step size</strong>: Even when the SDF returns very small values, we advance by at least \(\epsilon_{min}\) = 0.001 to prevent getting stuck in nearly-flat regions.</p>
</li>
<li>
<p><strong>Bounding box culling</strong>: Each <code>SDFObject</code> caches a conservative AABB of its SDF&#8217;s bounds, allowing the BVH to skip entire SDF evaluations for rays that can&#8217;t possibly hit.</p>
</li>
<li>
<p><strong>Reduced step count</strong>: Maximum steps are capped at 128 (compared to 256-512 in production renderers) to prioritize rendering speed over perfect convergence.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Integration with Raytracer:</strong></p>
</div>
<div class="paragraph">
<p>SDF objects integrate seamlessly with the existing raytracer infrastructure through the <code>SDFObject</code> geometry type in <code>Geometries.h</code>. Each <code>SDFObject</code> stores:
- A shared pointer to the root SDF (which may be a composite of transforms, booleans, and primitives)
- A material definition (same as other geometry types)
- Cached bounding box for BVH acceleration
- A flag (<code>useTriplanar</code>) indicating whether to use triplanar UV mapping for textures</p>
</div>
<div class="paragraph">
<p>When a ray intersects an <code>SDFObject</code>, the <code>intersectSDF()</code> function in <code>RayInteractions.h</code> calls <code>rayMarch()</code> with the SDF&#8217;s root node, converting the returned <code>RayMarchResult</code> (containing hit point, normal, and t-value) into a standard <code>HitRecord</code> for shading. This uniform interface allows SDFs to participate in all rendering features: shadows, reflections, refractions, texturing, and acceleration structures work identically whether the underlying geometry is explicit or implicit.</p>
</div>
<div class="paragraph">
<p>The main performance trade-off is that ray-marched SDFs require 50-128 function evaluations per ray (versus 1 evaluation for analytical primitives), making them 10-50x slower per intersection test. However, for shapes that would require millions of triangles to approximate (fractals, smooth CSG), SDFs remain the only practical option.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_optimization">Optimization</h3>
<div class="sect3">
<h4 id="_sampling">Sampling</h4>
<div class="listingblock">
<div class="content">
<pre># Configured in raytracer.cpp: samplesPerPixel = 8</pre>
</div>
</div>
<div class="paragraph">
<p>Anti-aliasing is achieved through stochastic supersampling, casting multiple rays per pixel with randomized offsets sampled from a Gaussian distribution (=0.3, clamped to 0.5 pixels). For each pixel, 8 rays are cast with slightly different directions computed by perturbing the pixel center coordinates, and the resulting colors are averaged to produce the final pixel value. This technique effectively reduces jagged edges (aliasing artifacts) along geometric boundaries and produces softer, more photorealistic images compared to single-sample rendering, at the cost of 8x more ray-geometry intersection tests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_recursion">Recursion</h4>
<div class="listingblock">
<div class="content">
<pre>max_depth: depth_value</pre>
</div>
</div>
<div class="paragraph">
<p>Recursive ray tracing is used to compute global illumination effects (reflections, refractions) by spawning secondary rays at surface intersection points up to a maximum depth limit. Each time a ray hits a reflective or transmissive surface, new rays are cast in the mirror and/or refracted directions, with their color contributions weighted by the material&#8217;s reflective/transmissive coefficients and added to the local shading. The recursion terminates when the ray depth counter reaches <code>max_depth</code> or when the accumulated energy falls below a threshold, preventing infinite recursion in scenes with facing mirrors while capturing multiple bounces of light; typical values range from 3-6 depending on scene complexity and desired realism.</p>
</div>
</div>
<div class="sect3">
<h4 id="_parallelization">Parallelization</h4>
<div id="parallelization" class="paragraph">
<p>The raytracer uses OpenMP to parallelize the rendering loop across all available CPU cores, distributing pixels among threads with dynamic load balancing. The main pixel iteration loop is parallelized with <code>#pragma omp parallel for schedule(dynamic, 16)</code>, where each thread maintains its own random number generator state to avoid contention and ensure reproducible results. Dynamic scheduling with a chunk size of 16 prevents load imbalance caused by varying ray complexity across the image (e.g., some pixels requiring many ray marching steps for SDFs while others hit simple spheres), achieving near-linear speedup; an 8-core system typically renders 7-7.5x faster than single-threaded execution.</p>
</div>
</div>
<div class="sect3">
<h4 id="_acceleration_with_bounding_volume_hierarchy">Acceleration with Bounding Volume Hierarchy</h4>
<div id="bvh" class="listingblock">
<div class="content">
<pre># Automatically enabled by default
accel: bvh  # Can also use: simple, octree, hybrid, none</pre>
</div>
</div>
<div class="paragraph">
<p>The Bounding Volume Hierarchy (BVH) is a spatial acceleration structure that dramatically improves ray tracing performance by organizing scene geometry into a binary tree of axis-aligned bounding boxes (AABBs), allowing rays to skip testing against large groups of objects through efficient hierarchical culling. Rather than testing every ray against every object in the scene (O(n) complexity per ray), the BVH enables logarithmic-time intersection queries by grouping nearby objects together and testing against progressively smaller bounding volumes. This acceleration structure is particularly effective for scenes with thousands of triangles, complex meshes, or mixed geometry types, providing 10-100x speedup over naive linear intersection testing in typical scenarios.</p>
</div>
<div class="paragraph">
<p><strong>BVH Construction Algorithm:</strong></p>
</div>
<div class="paragraph">
<p>Our BVH implementation in <code>BVH.h</code> uses a top-down recursive construction strategy with surface area heuristic (SAH)-inspired splitting. The construction algorithm begins by computing an AABB for each primitive in the scene (spheres, triangles, CSG objects, and SDF objects all have specialized bounding box computation in <code>computeAABB()</code>). The builder then recursively partitions the geometry using the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Base case</strong>: If the current node contains 4 primitives (configurable <code>maxLeafSize</code>), create a leaf node storing direct references to those geometries. Leaf nodes perform actual ray-geometry intersection tests when traversed.</p>
</li>
<li>
<p><strong>Choose split axis</strong>: Compute the bounding box extent in each dimension (X, Y, Z) and select the longest axis for splitting. This heuristic tends to create more balanced trees and better spatial separation than random axis selection.</p>
</li>
<li>
<p><strong>Sort primitives</strong>: Sort all primitives in the current partition by their centroid coordinate along the chosen axis. This enables efficient median-based splitting without explicitly computing SAH costs.</p>
</li>
<li>
<p><strong>Split at midpoint</strong>: Divide the sorted primitive list at the median (\(mid = start + count/2\)), ensuring balanced subtree sizes and O(log n) tree depth.</p>
</li>
<li>
<p><strong>Recurse</strong>: Recursively build left and right child nodes for the two partitions, propagating the split until all branches terminate in leaf nodes.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The resulting BVH tree structure uses <code>std::unique_ptr</code> for memory management, with each internal node storing its bounding box and pointers to left/right children, while leaf nodes store a vector of geometry pointers for intersection testing.</p>
</div>
<div class="paragraph">
<p><strong>Ray-BVH Traversal Algorithm:</strong></p>
</div>
<div class="paragraph">
<p>Ray traversal through the BVH uses a recursive depth-first search strategy that exploits the hierarchical nature of the structure. The traversal algorithm in <code>intersectRecursive()</code> follows these steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>AABB intersection test</strong>: Before examining a node&#8217;s contents, test whether the ray intersects the node&#8217;s bounding box using the slab method. The ray-AABB test computes entry/exit t-values for each axis using \(t_{near} = \frac{box_{min,i} - ray_{origin,i}}{ray_{dir,i}}\) and \(t_{far} = \frac{box_{max,i} - ray_{origin,i}}{ray_{dir,i}}\), then checks if the overlapping interval \([\max(t_{near,x}, t_{near,y}, t_{near,z}), \min(t_{far,x}, t_{far,y}, t_{far,z})\)] is valid and intersects the ray&#8217;s positive direction.</p>
</li>
<li>
<p><strong>Early termination</strong>: If the ray doesn&#8217;t intersect the node&#8217;s AABB, or if the intersection is beyond the current closest hit distance, immediately return without examining the node&#8217;s children. This culling is the key to BVH&#8217;s performancelarge portions of the tree are pruned based solely on bounding box tests.</p>
</li>
<li>
<p><strong>Leaf node processing</strong>: If the current node is a leaf (detected by checking if the geometry list is non-empty), iterate through all primitives in the leaf and perform actual ray-geometry intersection tests. Update the closest hit record if any intersection is closer than previously found hits.</p>
</li>
<li>
<p><strong>Internal node traversal</strong>: For internal nodes, recursively traverse both left and right children. The order doesn&#8217;t matter for correctness, but traversing the nearer child first can provide better early termination in some cases. Our implementation traverses both children and combines results with logical OR, ensuring all potential hits are considered.</p>
</li>
<li>
<p><strong>Closest hit propagation</strong>: The closest hit distance is maintained across all recursive calls, serving as a dynamic culling threshold. As closer hits are found during traversal, the updated distance allows more aggressive pruning of remaining branches.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Performance Characteristics:</strong></p>
</div>
<div class="paragraph">
<p>The BVH&#8217;s effectiveness stems from its ability to eliminate large portions of the scene from consideration with simple AABB tests. For a balanced BVH with n primitives:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Construction time</strong>: O(n log n) due to sorting at each level</p>
</li>
<li>
<p><strong>Memory</strong>: O(n) for internal nodes + leaf node storage</p>
</li>
<li>
<p><strong>Traversal time</strong>: O(log n) average case for point queries, though pathological cases (long rays passing through many nodes) can approach O(n)</p>
</li>
<li>
<p><strong>Ray coherence</strong>: Primary camera rays exhibit high coherence, often following similar paths through the BVH and benefiting from cache locality</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In practice, scenes with 10,000+ triangles see 50-100x speedup, while smaller scenes (100-1000 primitives) see 10-20x improvement. The BVH also benefits all geometry types uniformlyspheres, triangles, CSG objects, and ray-marched SDFs all gain acceleration, with the structure&#8217;s overhead being minimal (typically &lt;5% of render time for construction).</p>
</div>
<div class="paragraph">
<p><strong>BVH Variants:</strong></p>
</div>
<div class="paragraph">
<p>Our implementation includes several BVH variants accessible through the scene file <code>accel:</code> command:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>bvh</code></strong>: Full recursive BVH with median splitting (default, best overall performance)</p>
</li>
<li>
<p><strong><code>simple</code></strong>: Simplified BVH variant (BVH_Simple.h) with different split heuristics</p>
</li>
<li>
<p><strong><code>hybrid</code></strong>: BVH-Octree hybrid combining spatial and object subdivision for specific scene types</p>
</li>
<li>
<p><strong><code>none</code></strong>: Disables acceleration for benchmarking (linear intersection testing)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comparing these variants on complex scenes reveals that the standard BVH typically provides the best balance of construction speed and traversal performance, while the hybrid approach can excel in scenes with both dense meshes and scattered primitives.</p>
</div>
</div>
<div class="sect3">
<h4 id="_acceleration_with_octtrees">Acceleration with OctTrees</h4>
<div id="octree" class="listingblock">
<div class="content">
<pre>accel: octree  # Alternative spatial subdivision</pre>
</div>
</div>
<div class="paragraph">
<p>An Octree variant is also implemented as an alternative acceleration structure, recursively subdividing 3D space into eight octants (children) and distributing geometry among cells that overlap the primitives' bounding boxes. Unlike BVH which adapts to geometry distribution, the Octree uses uniform spatial subdivision, making it particularly effective for evenly distributed scenes but potentially less optimal for clustered geometry. The octree implementation shares the same interface as the BVH, allowing direct comparison of performance characteristics; in practice, BVH typically outperforms Octree for most scenes due to better adaptivity, though Octree can be advantageous for spatially coherent ray patterns like camera rays in architectural scenes.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_art_submission">Art Submission</h2>
<div class="sectionbody">
<div class="paragraph">
<div class="title">Art Submission</div>
<p>|<span class="image"><img src="Images/shadows/pokeball.png" alt="pokeball1" width="1200" height="900"></span></p>
</div>
<div class="paragraph">
<p>To create my submission, I followed the building procedure described above to create one pokeball. I then created two copies, and put them on a diagonal along <code>z</code> (to show nice shadows). To create the open pokeball, I needed to do two additional differences to create two halves of the interior black sphere. I then threw in a point light inside the ball to create the red glow, as if there&#8217;s something inside. I added four point lights in the environment to create some interesting lighting.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_access_source_code">Access source code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can access the source code here: <a href="https://drive.google.com/file/d/1gWPBcUY6EGGiIUYlj5ACjFjDTcB9en2X/view?usp=sharing" class="bare">https://drive.google.com/file/d/1gWPBcUY6EGGiIUYlj5ACjFjDTcB9en2X/view?usp=sharing</a>, which was compiled on a linux machine.</p>
</div>
<div class="paragraph">
<p><code>g -fsanitize=address -fopenmp -O3 -std=c17 raytracer.cpp -o raytracer</code></p>
</div>
</div>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "AMS" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>